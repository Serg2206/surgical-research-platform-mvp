(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{4012:function(e,s,t){Promise.resolve().then(t.bind(t,15)),Promise.resolve().then(t.bind(t,2213)),Promise.resolve().then(t.t.bind(t,5558,23))},2213:function(e,s,t){"use strict";t.d(s,{ClientAISearch:function(){return Z}});var a=t(5444),l=t(9300),r=t(5762),i=t(2422),n=t(4678),c=t(9827),d=t(4712),x=t(5522);let m=l.forwardRef(({className:e,children:s,...t},l)=>(0,a.jsxs)(d.fC,{ref:l,className:(0,x.cn)("relative overflow-hidden",e),...t,children:[(0,a.jsx)(d.l_,{className:"h-full w-full rounded-[inherit]",children:s}),(0,a.jsx)(o,{}),(0,a.jsx)(d.Ns,{})]}));m.displayName=d.fC.displayName;let o=l.forwardRef(({className:e,orientation:s="vertical",...t},l)=>(0,a.jsx)(d.gb,{ref:l,orientation:s,className:(0,x.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:(0,a.jsx)(d.q4,{className:"relative flex-1 rounded-full bg-border"})}));o.displayName=d.gb.displayName;var h=t(1033);let f=l.forwardRef(({className:e,orientation:s="horizontal",decorative:t=!0,...l},r)=>(0,a.jsx)(h.f,{ref:r,decorative:t,orientation:s,className:(0,x.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...l}));f.displayName=h.f.displayName;var u=t(1946),j=t(185),N=t(1572),p=t(4693),g=t(1178),y=t(5076),w=t(4614),b=t(6771),v=t(1084);function Z(){let{data:e,status:s}=(0,r.useSession)(),[t,d]=(0,l.useState)([]),[o,h]=(0,l.useState)(""),[Z,C]=(0,l.useState)(!1),[S,k]=(0,l.useState)(null),R=(0,l.useRef)(null),O=()=>{R.current?.scrollIntoView({behavior:"smooth"})};if((0,l.useEffect)(()=>{O()},[t]),"loading"===s)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(u.Z,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{children:"Загрузка..."})]})});if(!e)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,a.jsxs)(c.Zb,{className:"w-full max-w-md",children:[(0,a.jsx)(c.Ol,{className:"text-center",children:(0,a.jsx)(c.ll,{children:"Необходима авторизация"})}),(0,a.jsxs)(c.aY,{className:"text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Войдите в систему для использования AI поиска"}),(0,a.jsx)(i.z,{asChild:!0,children:(0,a.jsx)(v.default,{href:"/auth/signin",children:"Войти"})})]})]})});let z=async e=>{if(e.preventDefault(),!o.trim()||Z)return;let s={id:Date.now().toString(),role:"user",content:o.trim(),timestamp:new Date};d(e=>[...e,s]),h(""),C(!0);try{let e=await fetch("/api/ai-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o.trim(),context:"chat"})});if(!e.ok)throw Error("Failed to get AI response");let s=e.headers.get("X-Search-Results");if(s)try{k(JSON.parse(s))}catch(e){console.error("Failed to parse search results:",e)}let t=e.body?.getReader(),a=new TextDecoder,l={id:(Date.now()+1).toString(),role:"assistant",content:"",timestamp:new Date};if(d(e=>[...e,l]),t){let e="";for(;;){let{done:s,value:r}=await t.read();if(s)break;let i=a.decode(r,{stream:!0}),n=(e+=i).split("\n");for(let s of(e=n.pop()||"",n))if(s.startsWith("data: ")){let e=s.slice(6);if("[DONE]"===e)break;try{let s=JSON.parse(e),t=s.choices?.[0]?.delta?.content||"";t&&(l.content+=t,d(e=>e.map(e=>e.id===l.id?{...e,content:l.content}:e)))}catch(e){}}}}}catch(s){console.error("Error:",s);let e={id:(Date.now()+1).toString(),role:"assistant",content:"Извините, произошла ошибка при обработке вашего запроса. Попробуйте еще раз.",timestamp:new Date};d(s=>[...s,e])}finally{C(!1)}};return(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)(c.Zb,{className:"h-[600px] flex flex-col",children:[(0,a.jsx)(c.Ol,{className:"flex-shrink-0",children:(0,a.jsxs)(c.ll,{className:"flex items-center",children:[(0,a.jsx)(j.Z,{className:"h-5 w-5 mr-2"}),"AI Консультант"]})}),(0,a.jsxs)(c.aY,{className:"flex-1 flex flex-col",children:[(0,a.jsxs)(m,{className:"flex-1 pr-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[0===t.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(N.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("p",{children:"Задайте вопрос о хирургии, медицинских процедурах или найдите нужные курсы"})]}),t.map(e=>(0,a.jsx)("div",{className:`flex ${"user"===e.role?"justify-end":"justify-start"}`,children:(0,a.jsxs)("div",{className:`flex max-w-[80%] ${"user"===e.role?"flex-row-reverse":"flex-row"}`,children:[(0,a.jsx)("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${"user"===e.role?"bg-blue-600 ml-3":"bg-gray-200 mr-3"}`,children:"user"===e.role?(0,a.jsx)(p.Z,{className:"h-4 w-4 text-white"}):(0,a.jsx)(N.Z,{className:"h-4 w-4 text-gray-600"})}),(0,a.jsxs)("div",{className:`rounded-lg p-3 ${"user"===e.role?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),(0,a.jsx)("p",{className:`text-xs mt-2 ${"user"===e.role?"text-blue-100":"text-gray-500"}`,children:(0,x.p6)(e.timestamp)})]})]})},e.id)),Z&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gray-200 mr-3 flex items-center justify-center",children:(0,a.jsx)(N.Z,{className:"h-4 w-4 text-gray-600"})}),(0,a.jsx)("div",{className:"bg-gray-100 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 animate-spin"}),(0,a.jsx)("span",{className:"text-sm",children:"Анализирую запрос..."})]})})]})})]}),(0,a.jsx)("div",{ref:R})]}),(0,a.jsxs)("form",{onSubmit:z,className:"flex space-x-2 pt-4 border-t",children:[(0,a.jsx)(n.I,{value:o,onChange:e=>h(e.target.value),placeholder:"Задайте вопрос о хирургии, поищите курсы...",disabled:Z,className:"flex-1"}),(0,a.jsx)(i.z,{type:"submit",disabled:Z||!o.trim(),children:Z?(0,a.jsx)(u.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(g.Z,{className:"h-4 w-4"})})]})]})]})}),(0,a.jsxs)("div",{className:"lg:col-span-1",children:[(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(c.Ol,{children:(0,a.jsxs)(c.ll,{className:"flex items-center",children:[(0,a.jsx)(y.Z,{className:"h-5 w-5 mr-2"}),"Результаты поиска"]})}),(0,a.jsx)(c.aY,{children:S?(0,a.jsxs)("div",{className:"space-y-4",children:[S.courses.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-medium text-sm text-gray-900 mb-2 flex items-center",children:[(0,a.jsx)(w.Z,{className:"h-4 w-4 mr-1"}),"Курсы"]}),(0,a.jsx)("div",{className:"space-y-2",children:S.courses.map(e=>(0,a.jsxs)(v.default,{href:`/courses/${e.slug}`,className:"block p-2 border rounded hover:bg-gray-50",children:[(0,a.jsx)("h5",{className:"font-medium text-sm text-gray-900 line-clamp-2",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.category.name})]},e.id))})]}),S.articles.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)(f,{}),(0,a.jsxs)("h4",{className:"font-medium text-sm text-gray-900 mb-2 flex items-center pt-4",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 mr-1"}),"Статьи"]}),(0,a.jsx)("div",{className:"space-y-2",children:S.articles.map(e=>(0,a.jsxs)(v.default,{href:`/articles/${e.slug}`,className:"block p-2 border rounded hover:bg-gray-50",children:[(0,a.jsx)("h5",{className:"font-medium text-sm text-gray-900 line-clamp-2",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.category.name})]},e.id))})]}),0===S.courses.length&&0===S.articles.length&&(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"Нет результатов поиска"})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-8",children:"Результаты поиска появятся здесь после запроса"})})]}),(0,a.jsxs)(c.Zb,{className:"mt-4",children:[(0,a.jsx)(c.Ol,{children:(0,a.jsx)(c.ll,{className:"text-sm",children:"Быстрые действия"})}),(0,a.jsxs)(c.aY,{className:"space-y-2",children:[(0,a.jsx)(i.z,{variant:"outline",size:"sm",className:"w-full justify-start text-xs",asChild:!0,children:(0,a.jsxs)(v.default,{href:"/courses",children:[(0,a.jsx)(w.Z,{className:"h-3 w-3 mr-2"}),"Все курсы"]})}),(0,a.jsx)(i.z,{variant:"outline",size:"sm",className:"w-full justify-start text-xs",asChild:!0,children:(0,a.jsxs)(v.default,{href:"/articles",children:[(0,a.jsx)(b.Z,{className:"h-3 w-3 mr-2"}),"Все статьи"]})}),(0,a.jsx)(i.z,{variant:"outline",size:"sm",className:"w-full justify-start text-xs",asChild:!0,children:(0,a.jsxs)(v.default,{href:"/fhir",children:[(0,a.jsx)(y.Z,{className:"h-3 w-3 mr-2"}),"FHIR Данные"]})})]})]})]})]})}},9827:function(e,s,t){"use strict";t.d(s,{Ol:function(){return n},SZ:function(){return d},Zb:function(){return i},aY:function(){return x},eW:function(){return m},ll:function(){return c}});var a=t(5444),l=t(9300),r=t(5522);let i=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));i.displayName="Card";let n=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...s}));n.displayName="CardHeader";let c=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("h3",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));c.displayName="CardTitle";let d=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("p",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",e),...s}));d.displayName="CardDescription";let x=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",e),...s}));x.displayName="CardContent";let m=l.forwardRef(({className:e,...s},t)=>(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",e),...s}));m.displayName="CardFooter"}},function(e){e.O(0,[616,558,762,572,788,881,437,15,386,156,744],function(){return e(e.s=4012)}),_N_E=e.O()}]);